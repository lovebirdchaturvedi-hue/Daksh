<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Admin – RFQ Management | APD Global Trade</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{margin:0;font-family:Arial;background:#f5f7fb}
header{
  background:#020617;color:#fff;
  padding:18px 40px;
  display:flex;justify-content:space-between;align-items:center
}
.container{
  max-width:900px;
  margin:30px auto;
  background:#fff;
  padding:25px;
  border-radius:12px
}
input,select{
  width:100%;
  padding:12px;
  margin-bottom:12px;
  border-radius:8px;
  border:1px solid #d1d5db
}
button{
  padding:12px 18px;
  background:#2563eb;
  color:#fff;
  border:none;
  border-radius:8px;
  cursor:pointer;
  font-weight:600
}
.rfq{
  border-bottom:1px solid #e5e7eb;
  padding:12px 0
}
</style>
</head>

<body>

<header>
  <h2>Admin – RFQ Posting</h2>
  <button id="logout">Logout</button>
</header>

<div class="container">

<h3>Post New RFQ</h3>

<input id="product" placeholder="Product name">
<input id="quantity" placeholder="Quantity">
<input id="country" placeholder="Country">
<input id="buyer" placeholder="Buyer name">
<input id="email" placeholder="Buyer email">
<input id="phone" placeholder="Buyer phone">

<button onclick="postRFQ()">Post RFQ</button>

<hr style="margin:30px 0">

<h3>Existing RFQs</h3>
<div id="rfqs">Loading…</div>

</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth,onAuthStateChanged,signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { getFirestore,collection,addDoc,getDocs,deleteDoc,doc,serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const ADMIN_EMAIL = "admin@apdglobaltrade.com";

const app = initializeApp({
  apiKey:"AIzaSyABA-KRY6bY7K2QZwLhQ2piHjQVLLceiGs",
  authDomain:"apd-globaltrade-prod.firebaseapp.com",
  projectId:"apd-globaltrade-prod"
});

const auth = getAuth(app);
const db = getFirestore(app);

onAuthStateChanged(auth,user=>{
  if(!user || user.email !== ADMIN_EMAIL){
    location.href="/supplier-login.html";
  }
  loadRFQs();
});

window.postRFQ = async ()=>{
  await addDoc(collection(db,"rfqs"),{
    product:product.value,
    quantity:quantity.value,
    country:country.value,
    buyerName:buyer.value,
    email:email.value,
    phone:phone.value,
    status:"live",
    createdAt:serverTimestamp()
  });
  alert("RFQ posted");
  loadRFQs();
};

async function loadRFQs(){
  rfqs.innerHTML="";
  const snap = await getDocs(collection(db,"rfqs"));
  snap.forEach(d=>{
    const r=d.data();
    rfqs.innerHTML+=`
      <div class="rfq">
        <b>${r.product}</b> – ${r.country}
        <br>${r.quantity}
        <br>
        <button onclick="del('${d.id}')">Delete</button>
      </div>
    `;
  });
}

window.del = async id=>{
  await deleteDoc(doc(db,"rfqs",id));
  loadRFQs();
};

logout.onclick=async()=>{
  await signOut(auth);
  location.href="/supplier-login.html";
};
</script>

</body>
</html>
