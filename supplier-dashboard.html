<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Supplier Dashboard | APD Global Trade</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">

<style>
body {
  margin: 0;
  font-family: Inter, sans-serif;
  background: #f5f7fb;
}

header {
  background: #020617;
  color: #fff;
  padding: 16px 40px;
  display: flex;
  justify-content: space-between;
}

.dashboard {
  max-width: 1100px;
  margin: 40px auto;
  padding: 0 20px;
}

.card {
  background: #fff;
  padding: 24px;
  border-radius: 14px;
  margin-bottom: 20px;
}
</style>
</head>

<body>

<header>
  <div>APD Global Trade</div>
  <div>
    <a href="/rfq.html" style="color:#fff;margin-right:20px;">View RFQs</a>
    <a href="/membership.html" style="color:#fff;margin-right:20px;">Upgrade</a>
    <a href="#" id="logout" style="color:#fff;">Logout</a>
  </div>
</header>

<div class="dashboard">
  <div class="card">
    <h2>Welcome, Supplier</h2>
    <p>Status: <strong id="status">Loading...</strong></p>
    <p>Plan: <strong id="plan">Loading...</strong></p>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyABA-KRY6bY7K2QZwLhQ2piHjQVLLceiGs",
  authDomain: "apd-globaltrade-prod.firebaseapp.com",
  projectId: "apd-globaltrade-prod"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

const statusEl = document.getElementById("status");
const planEl = document.getElementById("plan");

onAuthStateChanged(auth, async (user) => {
  if (!user) {
    window.location.href = "/supplier-login.html";
    return;
  }

  const ref = doc(db, "suppliers", user.uid);
  const snap = await getDoc(ref);

  // ðŸ”¥ AUTO-FIX: CREATE DOC IF MISSING
  if (!snap.exists()) {
    await setDoc(ref, {
      email: user.email,
      status: "pending",
      plan: "free",
      createdAt: Date.now()
    });

    statusEl.innerText = "pending";
    planEl.innerText = "free";
    return;
  }

  const data = snap.data();
  statusEl.innerText = data.status || "pending";
  planEl.innerText = data.plan || "free";
});

document.getElementById("logout").onclick = async () => {
  await signOut(auth);
  window.location.href = "/supplier-login.html";
};
</script>

</body>
</html>
