<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Admin – Supplier Management</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{margin:0;font-family:Inter,sans-serif;background:#f5f7fb}
.header{padding:24px;display:flex;justify-content:space-between;align-items:center}
button{background:#020617;color:#fff;border:none;padding:10px 18px;border-radius:999px;cursor:pointer}
.table{max-width:1200px;margin:40px auto;background:#fff;border-radius:14px;overflow:hidden}
table{width:100%;border-collapse:collapse}
th,td{padding:14px;border-bottom:1px solid #e5e7eb}
th{background:#020617;color:#fff}
.center{padding:120px;text-align:center;font-weight:600}
.error{color:#991b1b}
</style>
</head>

<body>

<div class="header">
  <h2>Admin – Supplier Management</h2>
  <button id="logoutBtn">Logout</button>
</div>

<div class="table">
  <table>
    <thead>
      <tr>
        <th>Company</th>
        <th>Email</th>
        <th>Status</th>
        <th>Plan</th>
      </tr>
    </thead>
    <tbody id="tbody">
      <tr><td colspan="4" class="center">Loading…</td></tr>
    </tbody>
  </table>
</div>

<div id="error" class="center error" style="display:none">
  ❌ Unauthorized access (admin only)
</div>

<script type="module">
import { auth, db } from "/assets/js/firebase-init.js";
import { onAuthStateChanged, signOut }
  from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { collection, getDocs, doc, getDoc }
  from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const tbody = document.getElementById("tbody");
const error = document.getElementById("error");

onAuthStateChanged(auth, async (user) => {
  if (!user) {
    window.location.href = "/supplier-login.html";
    return;
  }

  const adminSnap = await getDoc(doc(db, "admins", user.uid));
  if (!adminSnap.exists()) {
    error.style.display = "block";
    tbody.innerHTML = "";
    return;
  }

  const snap = await getDocs(collection(db, "suppliers"));
  tbody.innerHTML = "";

  snap.forEach(d => {
    const s = d.data();
    tbody.innerHTML += `
      <tr>
        <td>${s.companyName || "-"}</td>
        <td>${s.email || "-"}</td>
        <td>${s.status || "-"}</td>
        <td>${s.plan || "-"}</td>
      </tr>
    `;
  });
});

document.getElementById("logoutBtn").onclick = async () => {
  await signOut(auth);
  window.location.href = "/supplier-login.html";
};
</script>

</body>
</html>
