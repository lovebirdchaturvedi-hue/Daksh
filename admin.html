<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Admin ‚Äì Supplier Management | APD Global Trade</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  margin:0;
  font-family:Inter,sans-serif;
  background:#f5f7fb;
  color:#0f172a;
}
.header{
  padding:30px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}
h1{
  margin:0;
}
button{
  padding:10px 18px;
  border:none;
  border-radius:999px;
  background:#020617;
  color:#fff;
  cursor:pointer;
  font-weight:600;
}
.table-wrap{
  max-width:1200px;
  margin:40px auto;
  background:#fff;
  border-radius:16px;
  overflow:hidden;
  box-shadow:0 20px 40px rgba(0,0,0,.08);
}
table{
  width:100%;
  border-collapse:collapse;
}
th,td{
  padding:16px;
  text-align:left;
  border-bottom:1px solid #e5e7eb;
  font-size:14px;
}
th{
  background:#020617;
  color:#fff;
}
.center{
  text-align:center;
  padding:120px 20px;
  font-weight:600;
}
.error{
  color:#991b1b;
}
</style>
</head>

<body>

<div class="header">
  <h1>Admin ‚Äì Supplier Management</h1>
  <button id="logoutBtn">Logout</button>
</div>

<div class="table-wrap">
  <table>
    <thead>
      <tr>
        <th>Company</th>
        <th>Email</th>
        <th>Status</th>
        <th>Plan</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody id="supplierTableBody">
      <tr>
        <td colspan="5" class="center">‚è≥ Loading suppliers‚Ä¶</td>
      </tr>
    </tbody>
  </table>
</div>

<div id="errorBox" class="center error" style="display:none">
  ‚ùå Unauthorized access (admin only)
</div>

<script type="module">
import { auth, db } from "/assets/js/firebase-init.js";
import { onAuthStateChanged, signOut }
  from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import {
  collection,
  getDocs,
  doc,
  getDoc
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const tableBody = document.getElementById("supplierTableBody");
const errorBox  = document.getElementById("errorBox");
const logoutBtn = document.getElementById("logoutBtn");

// üîê AUTH ‚Üí ADMIN ‚Üí LOAD SUPPLIERS (IN THIS ORDER)
onAuthStateChanged(auth, async (user) => {
  if (!user) {
    tableBody.innerHTML = "";
    errorBox.style.display = "block";
    return;
  }

  // üîê ADMIN CHECK
  const adminSnap = await getDoc(doc(db, "admins", user.uid));
  if (!adminSnap.exists()) {
    tableBody.innerHTML = "";
    errorBox.style.display = "block";
    return;
  }

  // ‚úÖ LOAD SUPPLIERS
  const snap = await getDocs(collection(db, "suppliers"));

  tableBody.innerHTML = "";

  if (snap.empty) {
    tableBody.innerHTML = `
      <tr>
        <td colspan="5" class="center">No suppliers found</td>
      </tr>
    `;
    return;
  }

  snap.forEach(docSnap => {
    const s = docSnap.data();
    const tr = document.createElement("tr");

    tr.innerHTML = `
      <td>${s.companyName || "-"}</td>
      <td>${s.email || "-"}</td>
      <td>${s.status || "pending"}</td>
      <td>${s.plan || "-"}</td>
      <td>‚Äî</td>
    `;

    tableBody.appendChild(tr);
  });
});

// ‚úÖ SAFE LOGOUT
logoutBtn.addEventListener("click", async () => {
  await signOut(auth);
  window.location.href = "/supplier-login.html";
});
</script>

</body>
</html>
