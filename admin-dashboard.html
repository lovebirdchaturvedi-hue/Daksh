<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Admin Dashboard – APD Global Trade</title>

<style>
body {
  font-family: Inter, Arial, sans-serif;
  background: #f5f7fb;
  padding: 30px;
}

h1 {
  margin-bottom: 5px;
}

#status {
  margin-bottom: 20px;
  font-weight: bold;
}

.card {
  background: #fff;
  border-radius: 10px;
  padding: 15px;
  margin-bottom: 15px;
  box-shadow: 0 4px 12px rgba(0,0,0,.08);
}

.actions button {
  margin-right: 8px;
  padding: 6px 12px;
  border-radius: 6px;
  border: none;
  cursor: pointer;
}

.approve { background:#22c55e; color:#fff; }
.ban { background:#ef4444; color:#fff; }
.upgrade { background:#6366f1; color:#fff; }
.unban { background:#f59e0b; color:#fff; }

.plan {
  font-weight: bold;
  margin-left: 8px;
}
</style>
</head>

<body>

<h1>Admin Dashboard</h1>
<p id="status">Checking access…</p>

<button id="logoutBtn">Logout</button>

<hr>

<div id="supplierList"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { getFirestore, collection, getDocs, doc, updateDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyABA-KRY6bY7K2QZwLhQ2piHjQVLLceiGs",
  authDomain: "apd-globaltrade-prod.firebaseapp.com",
  projectId: "apd-globaltrade-prod"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

const statusEl = document.getElementById("status");
const listEl = document.getElementById("supplierList");

onAuthStateChanged(auth, async (user) => {
  if (!user) {
    statusEl.innerText = "Please login as admin.";
    return;
  }

  if (user.email !== "admin@apdglobaltrade.com") {
    statusEl.innerText = "Access denied.";
    await signOut(auth);
    return;
  }

  statusEl.innerText = "Admin logged in";
  loadSuppliers();
});

async function loadSuppliers() {
  listEl.innerHTML = "";
  const snap = await getDocs(collection(db, "suppliers"));

  snap.forEach((docSnap) => {
    const s = docSnap.data();
    const id = docSnap.id;

    const div = document.createElement("div");
    div.className = "card";

    div.innerHTML = `
      <strong>${s.companyName || "Supplier"}</strong><br>
      Email: ${s.email || "—"}<br>
      Status: ${s.banned ? "BANNED" : "ACTIVE"}<br>
      Plan: <span class="plan">${s.plan || "Free"}</span>

      <div class="actions">
        <button class="approve" data-id="${id}" data-action="approve">Approve</button>
        <button class="upgrade" data-id="${id}" data-plan="Gold">Upgrade Gold</button>
        <button class="upgrade" data-id="${id}" data-plan="Platinum">Upgrade Platinum</button>
        ${s.banned
          ? `<button class="unban" data-id="${id}" data-action="unban">Unban</button>`
          : `<button class="ban" data-id="${id}" data-action="ban">Ban</button>`
        }
      </div>
    `;

    listEl.appendChild(div);
  });
}

document.addEventListener("click", async (e) => {
  const id = e.target.dataset.id;
  if (!id) return;

  const ref = doc(db, "suppliers", id);

  if (e.target.dataset.action === "approve") {
    await updateDoc(ref, { approved: true });
  }

  if (e.target.dataset.action === "ban") {
    await updateDoc(ref, { banned: true });
  }

  if (e.target.dataset.action === "unban") {
    await updateDoc(ref, { banned: false });
  }

  if (e.target.dataset.plan) {
    await updateDoc(ref, { plan: e.target.dataset.plan });
  }

  loadSuppliers();
});

document.getElementById("logoutBtn").onclick = async () => {
  await signOut(auth);
  location.reload();
};
</script>

</body>
</html>
