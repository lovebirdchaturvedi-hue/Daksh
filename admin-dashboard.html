<!DOCTYPE html>
<html>
<head>
  <title>Admin Dashboard</title>
</head>
<body>

<h1>Admin Dashboard</h1>
<p id="status">Checking login…</p>
<ul id="list"></ul>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { getFirestore, collection, getDocs, doc, updateDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyABA-KRY6bY7K2QZwLhQ2piHjQVLLceiGs",
  authDomain: "apd-globaltrade-prod.firebaseapp.com",
  projectId: "apd-globaltrade-prod"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

const status = document.getElementById("status");
const list = document.getElementById("list");

onAuthStateChanged(auth, async (user) => {

  if (!user) {
    status.innerText = "Please login first.";
    return;
  }

  if (user.email !== "admin@apdglobaltrade.com") {
    status.innerText = "Access denied.";
    return;
  }

  status.innerText = "Admin logged in. Loading suppliers…";

  const snap = await getDocs(collection(db, "suppliers"));
  list.innerHTML = "";

  snap.forEach(d => {
    const li = document.createElement("li");
    li.innerHTML = `
      ${d.data().companyName || "Supplier"}
      <button onclick="approve('${d.id}')">Approve</button>
    `;
    list.appendChild(li);
  });
});

window.approve = async (id) => {
  await updateDoc(doc(db, "suppliers", id), { status: "approved" });
  alert("Approved");
};
</script>

</body>
</html>
