<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Live Buyer RFQs | APD Global Trade</title>

<link rel="manifest" href="/manifest.json">
<meta name="theme-color" content="#020617">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">

<style>
body {
  margin:0;
  font-family:Inter,sans-serif;
  background:#f5f7fb;
  color:#0f172a;
}
header {
  height:80px;
  background:#071427;
  display:flex;
  align-items:center;
  justify-content:center;
  flex-direction:column;
}
header .logo {
  color:#c9a44a;
  font-weight:600;
}
header nav a {
  color:#e5e7eb;
  margin:0 12px;
  text-decoration:none;
  font-size:13px;
}
.section {
  max-width:1100px;
  margin:auto;
  padding:80px 20px;
}
.rfq-grid {
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(280px,1fr));
  gap:30px;
  margin-top:40px;
}
.rfq-card {
  background:#fff;
  padding:26px;
  border-radius:16px;
  border:1px solid #e5e7eb;
}
.rfq-card h3 {
  margin-top:0;
}
.buyer-contact {
  display:none;
  margin-top:12px;
  font-size:14px;
}
.buyer-locked {
  color:#991b1b;
  font-size:13px;
  font-weight:600;
  margin-top:12px;
}
.buyer-locked a {
  color:#991b1b;
}
.cta {
  background:#020617;
  color:#fff;
  text-align:center;
  padding:80px 20px;
}
.cta a {
  background:#c9a44a;
  color:#000;
  padding:14px 32px;
  border-radius:999px;
  text-decoration:none;
  font-weight:600;
}
footer {
  background:#020617;
  color:#9ca3af;
  text-align:center;
  padding:50px 20px;
  font-size:14px;
}
</style>
</head>

<body>

<header>
  <div class="logo">APD Global Trade</div>
  <nav>
    <a href="/index.html">Home</a>
    <a href="/rfq.html">Buyer RFQs</a>
    <a href="/membership.html">Membership</a>
  </nav>
</header>

<section class="section">
  <h1>Live Buyer RFQs</h1>
  <p>
    Verified buyer requirements. Buyer contact details are visible only to
    approved Gold & Platinum suppliers.
  </p>

  <div class="rfq-grid" id="rfqGrid"></div>
</section>

<section class="cta">
  <h2>Unlock Buyer Contact Details</h2>
  <p>Upgrade your supplier membership to access full RFQ details.</p>
  <a href="/membership.html">View Membership Plans</a>
</section>

<footer>
  <p style="color:#c9a44a;font-weight:600;">APD Global Trade</p>
  <p>Elite B2B Trade Facilitation Platform</p>
</footer>

<!-- ================= MOCK RFQ GENERATOR (100 RFQs) ================= -->
<script>
const products = [
  "Basmati Rice 1121","Non Basmati Rice","Red Chilli Powder","Turmeric Finger",
  "Fresh Onion","Fresh Garlic","Cashew Nuts","Raw Cotton",
  "Indian Spice Mix","Sugar ICUMSA 45","Wheat Flour","Maize Corn",
  "Frozen Chicken","Seafood Shrimps","Granite Slabs","Ceramic Tiles",
  "Steel TMT Bars","Aluminium Ingots","Plastic Granules","LED Lights"
];

const destinations = [
  "UAE","USA","UK","Germany","France","Saudi Arabia","Qatar","Oman",
  "South Africa","Nigeria","Kenya","Bangladesh","Vietnam","Malaysia"
];

const grid = document.getElementById("rfqGrid");

for (let i = 1; i <= 100; i++) {
  const product = products[Math.floor(Math.random() * products.length)];
  const destination = destinations[Math.floor(Math.random() * destinations.length)];
  const qty = Math.floor(Math.random() * 900 + 50) + " MT";

  const card = document.createElement("div");
  card.className = "rfq-card";

  card.innerHTML = `
    <h3>${product}</h3>
    <p>Quantity: ${qty}</p>
    <p>Destination: ${destination}</p>

    <div class="buyer-contact">
      ðŸ“§ buyer${i}@company.com<br>
      ðŸ“ž +XXX-XXX-${1000 + i}
    </div>

    <div class="buyer-locked">
      ðŸ”’ Buyer contact available to verified Gold & Platinum suppliers only<br>
      <a href="/membership.html">Upgrade Membership</a>
    </div>
  `;

  grid.appendChild(card);
}
</script>

<!-- ================= FIREBASE ACCESS CONTROL ================= -->
<script type="module">
import { auth, db } from "/assets/js/firebase-init.js";
import { onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { doc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

onAuthStateChanged(auth, async (user) => {
  if (!user) return;

  // ðŸ” Admin redirect
  const token = await user.getIdTokenResult(true);
  if (token.claims.admin === true) {
    window.location.replace("/admin.html");
    return;
  }

  // ðŸ” Supplier check
  const snap = await getDoc(doc(db, "suppliers", user.uid));
  if (!snap.exists()) return;

  const supplier = snap.data();

  // âœ… Approved Gold / Platinum
  if (
    supplier.status === "approved" &&
    (supplier.plan === "gold" || supplier.plan === "platinum")
  ) {
    document.querySelectorAll(".buyer-locked")
      .forEach(el => el.style.display = "none");
    document.querySelectorAll(".buyer-contact")
      .forEach(el => el.style.display = "block");
  }
});
</script>

</body>
</html>
